var W=Object.defineProperty;var D=(i,t,e)=>t in i?W(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var d=(i,t,e)=>D(i,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();const R=`var $=Object.defineProperty;var j=(G,C,M)=>C in G?$(G,C,{enumerable:!0,configurable:!0,writable:!0,value:M}):G[C]=M;var h=(G,C,M)=>j(G,typeof C!="symbol"?C+"":C,M);(function(){"use strict";const G={background:[.06,.06,.07,1],text:[.85,.85,.86,1],address:[.55,.72,.78,1],dim:[.55,.55,.56,1],selectionBg:[.16,.36,.78,1],selectionFg:[.97,.97,.98,1],scrollTrack:[.1,.1,.12,1],scrollThumb:[.22,.22,.25,1],scrollThumbActive:[.35,.35,.38,1]};function C(a,t){return t?{background:t.background??a.background,text:t.text??a.text,address:t.address??a.address,dim:t.dim??a.dim,selectionBg:t.selectionBg??a.selectionBg,selectionFg:t.selectionFg??a.selectionFg,scrollTrack:t.scrollTrack??a.scrollTrack,scrollThumb:t.scrollThumb??a.scrollThumb,scrollThumbActive:t.scrollThumbActive??a.scrollThumbActive}:a}function M(a,t,e,s,i){const n=a+1,r=n+e,o=2+s,c=r+o*t+i;return{addrChars:n,hexStartChar:r,asciiStartChar:c}}function L(a){self.postMessage(a)}function m(a,t,e){return Math.max(t,Math.min(e,a))}function q(a){const t=a.toString(16).toUpperCase();return t.length===1?\`0\${t}\`:t}function H(a,t,e,s,i,n,r,o){const c=Math.max(1,a-s),l=Math.max(1,Math.floor(c/t)),w=e+1+n+o,P=2+r+1,y=Math.floor((l-w)/P);return m(y,Math.max(1,Math.floor(i)),1024)}function A(a){return a<=65535?4:a<=4294967295?8:16}function z(){const a=new Set;for(let t=32;t<=126;t++)a.add(String.fromCharCode(t));return a.add("Â·"),a.add("	"),a.delete("	"),Array.from(a)}function _(a,t,e,s){const n=Math.ceil(s.length/16),r=16*t,o=n*e,l=new OffscreenCanvas(r,o).getContext("2d",{alpha:!0,desynchronized:!0});if(!l)throw new Error("Failed to create 2D context for glyph atlas.");l.clearRect(0,0,r,o),l.font=a,l.fillStyle="rgba(255,255,255,1)",l.textBaseline="middle",l.textAlign="center";const b=new Map;for(let y=0;y<s.length;y++){const T=s[y],x=y%16,f=Math.floor(y/16),R=x*t,B=f*e;l.fillText(T,R+t/2,B+e/2),b.set(T,{u0:R/r,v0:B/o,u1:(R+t)/r,v1:(B+e)/o})}const w=l.getImageData(0,0,r,o),P=new Uint8Array(w.data.buffer.slice(0));return{map:b,rgba:P,width:r,height:o}}function X(a){return\`\${a}px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace\`}function O(a){const t=X(a),s=new OffscreenCanvas(32,32).getContext("2d",{alpha:!0,desynchronized:!0});if(!s)throw new Error("Failed to create 2D context for font metrics.");s.font=t;const i=s.measureText("M"),n=Math.max(1,Math.round(i.width)),r=Math.max(1,Math.ceil((i.actualBoundingBoxAscent||a)+(i.actualBoundingBoxDescent||Math.ceil(a*.25)))),o=Math.max(8,n),c=Math.max(12,Math.ceil(r*1.25));return{cellW:o,cellH:c,fontCss:t}}class K{constructor(){h(this,"canvas",null);h(this,"ctx",null);h(this,"device",null);h(this,"format",null);h(this,"pipeline",null);h(this,"bindGroup",null);h(this,"uniformBuf",null);h(this,"quadBuf",null);h(this,"instanceBuf",null);h(this,"instanceCapacityFloats",0);h(this,"instanceData",new Float32Array(0));h(this,"glyphMap",null);h(this,"atlasTexture",null);h(this,"atlasSampler",null);h(this,"fontPx",14);h(this,"cellW",8);h(this,"cellH",16);h(this,"fontCss","");h(this,"scrollBarWidthPx",20);h(this,"minBytesPerRow",4);h(this,"theme",G);h(this,"bytesPerRow",16);h(this,"addrDigits",8);h(this,"addressGapChars",1);h(this,"hexGapChars",1);h(this,"sectionGapChars",2);h(this,"scrollY",0);h(this,"selAnchor",null);h(this,"selStart",null);h(this,"selEnd",null);h(this,"scrollDragActive",!1);h(this,"scrollDragStartY",0);h(this,"scrollDragStartScrollY",0);h(this,"totalBytes",0);h(this,"data",null);h(this,"width",1);h(this,"height",1);h(this,"running",!1);h(this,"rafId",null)}async init(t){this.canvas=t.canvas,this.resize(t.width,t.height);const e=self.navigator.gpu;if(!e){const c=\`WebGPU ä¸å¯ç”¨ã€‚è¯·ç¡®ä¿:
1. ä½¿ç”¨æ”¯æŒ WebGPU çš„æµè§ˆå™¨(Chrome 113+, Edge 113+)
2. åœ¨æµè§ˆå™¨ä¸­å¯ç”¨ WebGPU åŠŸèƒ½
3. ä½¿ç”¨ HTTPS æˆ– localhost è®¿é—®é¡µé¢

Chrome/Edge å¯ç”¨æ–¹æ³•:
è®¿é—® chrome://flags/#enable-unsafe-webgpu
å¯ç”¨ 'Unsafe WebGPU' é€‰é¡¹å¹¶é‡å¯æµè§ˆå™¨\`;throw new Error(c)}const s=await e.requestAdapter({powerPreference:"high-performance",forceFallbackAdapter:!1});if(!s){const c=\`æ— æ³•èŽ·å– WebGPU é€‚é…å™¨ã€‚å¯èƒ½çš„åŽŸå› :
1. æ‚¨çš„ GPU é©±åŠ¨ç¨‹åºéœ€è¦æ›´æ–°
2. æµè§ˆå™¨çš„ WebGPU åŠŸèƒ½è¢«ç¦ç”¨
3. æ‚¨çš„ GPU ä¸æ”¯æŒ WebGPU

è§£å†³æ–¹æ³•:
â€¢ æ›´æ–°æ˜¾å¡é©±åŠ¨ç¨‹åº
â€¢ åœ¨ Chrome ä¸­è®¿é—® chrome://gpu æ£€æŸ¥ WebGPU çŠ¶æ€
â€¢ å°è¯•åœ¨ chrome://flags ä¸­å¯ç”¨ WebGPU ç›¸å…³é€‰é¡¹\`;throw new Error(c)}this.device=await s.requestDevice({});const i=this.canvas.getContext("webgpu");if(!i)throw new Error("Failed to get 'webgpu' context from OffscreenCanvas.");this.ctx=i,this.format=e.getPreferredCanvasFormat(),typeof t.fontPx=="number"&&Number.isFinite(t.fontPx)&&(this.fontPx=m(Math.floor(t.fontPx),8,48)),typeof t.scrollBarWidthPx=="number"&&Number.isFinite(t.scrollBarWidthPx)&&(this.scrollBarWidthPx=m(Math.floor(t.scrollBarWidthPx),8,64)),typeof t.minBytesPerRow=="number"&&Number.isFinite(t.minBytesPerRow)&&(this.minBytesPerRow=m(Math.floor(t.minBytesPerRow),1,1024)),this.theme=C(G,t.theme),typeof t.addressGapChars=="number"&&(this.addressGapChars=m(t.addressGapChars,0,8)),typeof t.hexGapChars=="number"&&(this.hexGapChars=m(t.hexGapChars,0,8)),typeof t.sectionGapChars=="number"&&(this.sectionGapChars=m(t.sectionGapChars,0,16));const{cellW:n,cellH:r,fontCss:o}=O(this.fontPx);this.cellW=n,this.cellH=r,this.fontCss=o,this.addrDigits=A(this.totalBytes-1),this.bytesPerRow=H(this.width,this.cellW,this.addrDigits,this.scrollBarWidthPx,this.minBytesPerRow,this.addressGapChars,this.hexGapChars,this.sectionGapChars),this.configure(),this.buildResources(),this.running=!0,this.frame()}resize(t,e){this.width=Math.max(1,Math.floor(t)),this.height=Math.max(1,Math.floor(e)),this.canvas&&(this.canvas.width=this.width,this.canvas.height=this.height),this.ctx&&this.device&&this.format&&(this.configure(),this.addrDigits=A(this.totalBytes-1),this.bytesPerRow=H(this.width,this.cellW,this.addrDigits,this.scrollBarWidthPx,this.minBytesPerRow,this.addressGapChars,this.hexGapChars,this.sectionGapChars),this.clampScroll())}configure(){!this.ctx||!this.device||!this.format||this.ctx.configure({device:this.device,format:this.format,alphaMode:"opaque"})}buildResources(){if(!this.device||!this.ctx||!this.format)return;this.pipeline=null,this.bindGroup=null,this.uniformBuf=null,this.quadBuf=null,this.instanceBuf=null,this.instanceCapacityFloats=0,this.instanceData=new Float32Array(0),this.glyphMap=null,this.atlasTexture=null,this.atlasSampler=null;const t=z(),e=_(this.fontCss,this.cellW,this.cellH,t);this.glyphMap=e.map;const s=e.rgba;this.atlasTexture=this.device.createTexture({size:[e.width,e.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),this.device.queue.writeTexture({texture:this.atlasTexture},s,{bytesPerRow:e.width*4},{width:e.width,height:e.height,depthOrArrayLayers:1}),this.atlasSampler=this.device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}),this.uniformBuf=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const i=new Float32Array([0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,1,1,0,1,0,1,1,1,1]);this.quadBuf=this.device.createBuffer({size:i.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.device.queue.writeBuffer(this.quadBuf,0,i);const n=this.device.createShaderModule({code:\`
struct Uniforms {
  viewport: vec2<f32>,
  _pad: vec2<f32>,
};

@group(0) @binding(0) var<uniform> u: Uniforms;
@group(0) @binding(1) var s: sampler;
@group(0) @binding(2) var t: texture_2d<f32>;

struct VSIn {
  @location(0) aPos: vec2<f32>,
  @location(1) aUv: vec2<f32>,

  @location(2) iPos: vec2<f32>,
  @location(3) iSize: vec2<f32>,
  @location(4) iUv0: vec2<f32>,
  @location(5) iUv1: vec2<f32>,
  @location(6) iFg: vec4<f32>,
  @location(7) iBg: vec4<f32>,
};

struct VSOut {
  @builtin(position) pos: vec4<f32>,
  @location(0) uv: vec2<f32>,
  @location(1) fg: vec4<f32>,
  @location(2) bg: vec4<f32>,
};

@vertex
fn vsMain(in: VSIn) -> VSOut {
  var out: VSOut;
  let px = in.iPos + in.aPos * in.iSize;
  let ndcX = (px.x / u.viewport.x) * 2.0 - 1.0;
  let ndcY = 1.0 - (px.y / u.viewport.y) * 2.0;
  out.pos = vec4<f32>(ndcX, ndcY, 0.0, 1.0);

  out.uv = mix(in.iUv0, in.iUv1, in.aUv);
  out.fg = in.iFg;
  out.bg = in.iBg;
  return out;
}

@fragment
fn fsMain(in: VSOut) -> @location(0) vec4<f32> {
  let a = textureSample(t, s, in.uv).a;
  return in.bg * (1.0 - a) + in.fg * a;
}
\`}),r=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}}]}),o=this.device.createPipelineLayout({bindGroupLayouts:[r]});this.pipeline=this.device.createRenderPipeline({layout:o,vertex:{module:n,entryPoint:"vsMain",buffers:[{arrayStride:16,attributes:[{shaderLocation:0,offset:0,format:"float32x2"},{shaderLocation:1,offset:8,format:"float32x2"}]},{arrayStride:64,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float32x2"},{shaderLocation:3,offset:8,format:"float32x2"},{shaderLocation:4,offset:16,format:"float32x2"},{shaderLocation:5,offset:24,format:"float32x2"},{shaderLocation:6,offset:32,format:"float32x4"},{shaderLocation:7,offset:48,format:"float32x4"}]}]},fragment:{module:n,entryPoint:"fsMain",targets:[{format:this.format}]},primitive:{topology:"triangle-list"}}),this.bindGroup=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:this.uniformBuf}},{binding:1,resource:this.atlasSampler},{binding:2,resource:this.atlasTexture.createView()}]}),this.ensureInstanceCapacity(8192)}contentHeightPx(){return Math.ceil(this.totalBytes/this.bytesPerRow)*this.cellH}maxScrollY(){return Math.max(0,this.contentHeightPx()-this.height)}clampScroll(){this.scrollY=m(this.scrollY,0,this.maxScrollY())}scrollBarMetrics(){const t=this.scrollBarWidthPx,e=this.height,s=this.width-t,i=0,n=this.contentHeightPx(),r=this.height;if(n<=r)return{x:s,y:i,w:t,h:e,thumbY:0,thumbH:e};const c=Math.max(24,Math.floor(r/n*e)),l=e-c,b=Math.floor(this.scrollY/(n-r)*l);return{x:s,y:i,w:t,h:e,thumbY:b,thumbH:c}}hitTestScrollBar(t,e){if(this.contentHeightPx()<=this.height)return{hit:!1,onThumb:!1};const s=this.scrollBarMetrics();return t<s.x||t>s.x+s.w||e<0||e>s.h?{hit:!1,onThumb:!1}:{hit:!0,onThumb:e>=s.thumbY&&e<=s.thumbY+s.thumbH}}setScrollFromThumbY(t){const e=this.scrollBarMetrics(),s=this.contentHeightPx(),i=this.height;if(s<=i){this.scrollY=0;return}const n=e.h-e.thumbH,r=n<=0?0:m(t/n,0,1);this.scrollY=r*(s-i),this.clampScroll()}byteIndexAt(t,e){const s=M(this.addrDigits,this.bytesPerRow,this.addressGapChars,this.hexGapChars,this.sectionGapChars),i=Math.floor((e+this.scrollY)/this.cellH);if(i<0)return null;const n=i*this.bytesPerRow;if(n>=this.totalBytes)return null;const r=Math.min(this.bytesPerRow,this.totalBytes-n),o=s.hexStartChar*this.cellW,c=(2+this.hexGapChars)*this.cellW,l=o+r*c,b=s.asciiStartChar*this.cellW,w=b+r*this.cellW;if(t>=o&&t<l){const P=t-o,y=Math.floor(P/c);if(y>=0&&y<r){const T=n+y;return T<this.totalBytes?T:null}}if(t>=b&&t<w){const P=Math.floor((t-b)/this.cellW);if(P>=0&&P<r){const y=n+P;return y<this.totalBytes?y:null}}return null}ensureInstanceCapacity(t){if(!this.device)return;const s=t*16;this.instanceCapacityFloats>=s&&this.instanceBuf||(this.instanceCapacityFloats=Math.max(s,this.instanceCapacityFloats*2,16*2048),this.instanceData=new Float32Array(this.instanceCapacityFloats),this.instanceBuf=this.device.createBuffer({size:this.instanceData.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}))}putChar(t,e,s,i,n,r,o){const c=this.glyphMap;if(!c)return e;const l=c.get(n)??c.get("Â·")??c.get(" ");return l?(t[e+0]=s,t[e+1]=i,t[e+2]=this.cellW,t[e+3]=this.cellH,t[e+4]=l.u0,t[e+5]=l.v0,t[e+6]=l.u1,t[e+7]=l.v1,t[e+8]=r[0],t[e+9]=r[1],t[e+10]=r[2],t[e+11]=r[3],t[e+12]=o[0],t[e+13]=o[1],t[e+14]=o[2],t[e+15]=o[3],e+16):e}putRect(t,e,s,i,n,r,o){const c=this.glyphMap;if(!c)return e;const l=c.get(" ")??c.get("Â·");return l?(t[e+0]=s,t[e+1]=i,t[e+2]=n,t[e+3]=r,t[e+4]=l.u0,t[e+5]=l.v0,t[e+6]=l.u1,t[e+7]=l.v1,t[e+8]=0,t[e+9]=0,t[e+10]=0,t[e+11]=0,t[e+12]=o[0],t[e+13]=o[1],t[e+14]=o[2],t[e+15]=o[3],e+16):e}syntheticByte(t){return this.data&&t>=0&&t<this.data.length?this.data[t]:t*1103515245+12345>>>0>>>16&255}drawHexView(){if(!this.glyphMap)return 0;const t=this.theme.background,e=this.theme.text,s=this.theme.address,i=this.theme.dim,n=this.theme.selectionBg,r=this.theme.selectionFg,o=Math.ceil(this.height/this.cellH)+2,c=Math.max(0,Math.floor(this.scrollY/this.cellH)),l=-(this.scrollY-c*this.cellH),b=this.addrDigits+1,w=2+this.hexGapChars+1,y=b+this.addressGapChars+this.sectionGapChars+w*this.bytesPerRow,T=o*(y+8);this.ensureInstanceCapacity(T);const x=this.instanceData;let f=0;const R=M(this.addrDigits,this.bytesPerRow,this.addressGapChars,this.hexGapChars,this.sectionGapChars),B=this.width-this.scrollBarWidthPx;for(let g=0;g<o;g++){const F=(c+g)*this.bytesPerRow;if(F>=this.totalBytes)break;const v=l+g*this.cellH;if(v<-this.cellH||v>this.height+this.cellH)continue;let S=F.toString(16).toUpperCase();for(;S.length<this.addrDigits;)S=\`0\${S}\`;S=\`\${S}:\`;for(let u=0;u<S.length;u++){const p=u*this.cellW;if(p>=B)break;f=this.putChar(x,f,p,v,S[u],s,t)}for(let u=0;u<this.addressGapChars;u++){const p=(S.length+u)*this.cellW;if(p>=B)break;f=this.putChar(x,f,p,v," ",e,t)}for(let u=0;u<this.bytesPerRow;u++){const p=F+u,U=p<this.totalBytes?this.syntheticByte(p):0,Y=q(U),W=(R.hexStartChar+u*(2+this.hexGapChars))*this.cellW;if(W>=B)break;const D=this.selStart!==null&&this.selEnd!==null&&p>=this.selStart&&p<=this.selEnd,E=D?r:e,k=D?n:t;f=this.putChar(x,f,W+0*this.cellW,v,Y[0],E,k),f=this.putChar(x,f,W+1*this.cellW,v,Y[1],E,k);for(let V=0;V<this.hexGapChars;V++)f=this.putChar(x,f,W+(2+V)*this.cellW,v," ",e,t)}for(let u=0;u<this.sectionGapChars;u++){const p=(R.asciiStartChar-this.sectionGapChars+u)*this.cellW;if(p>=B)break;f=this.putChar(x,f,p,v," ",i,t)}for(let u=0;u<this.bytesPerRow;u++){const p=F+u,U=p<this.totalBytes?this.syntheticByte(p):0,Y=U>=32&&U<=126?String.fromCharCode(U):".",W=(R.asciiStartChar+u)*this.cellW;if(W>=B)break;const D=this.selStart!==null&&this.selEnd!==null&&p>=this.selStart&&p<=this.selEnd,E=D?r:e,k=D?n:t;f=this.putChar(x,f,W,v,Y,E,k)}}if(this.contentHeightPx()>this.height){const g=this.scrollBarMetrics(),N=this.theme.scrollTrack,F=this.scrollDragActive?this.theme.scrollThumbActive:this.theme.scrollThumb;f=this.putRect(x,f,g.x,0,g.w,g.h,N),f=this.putRect(x,f,g.x,g.thumbY,g.w,g.thumbH,F)}return f/16}scheduleNextFrame(){const t=self;if(typeof t.requestAnimationFrame=="function"){this.rafId=t.requestAnimationFrame(()=>this.frame());return}this.rafId=self.setTimeout(()=>this.frame(),16)}frame(){if(!this.running||!this.device||!this.ctx)return;if(!this.pipeline||!this.bindGroup||!this.uniformBuf||!this.quadBuf||!this.instanceBuf){this.scheduleNextFrame();return}const t=new Float32Array([this.width,this.height,0,0]);this.device.queue.writeBuffer(this.uniformBuf,0,t);const e=this.drawHexView();e>0&&this.device.queue.writeBuffer(this.instanceBuf,0,this.instanceData.subarray(0,e*16));const s=this.device.createCommandEncoder(),i=this.ctx.getCurrentTexture().createView(),n=this.theme.background,r=s.beginRenderPass({colorAttachments:[{view:i,clearValue:{r:n[0],g:n[1],b:n[2],a:n[3]},loadOp:"clear",storeOp:"store"}]});r.setPipeline(this.pipeline),r.setBindGroup(0,this.bindGroup),r.setVertexBuffer(0,this.quadBuf),r.setVertexBuffer(1,this.instanceBuf),e>0&&r.draw(6,e,0,0),r.end(),this.device.queue.submit([s.finish()]),this.scheduleNextFrame()}onWheel(t){const e=t.shiftKey?3:1;this.scrollY+=t.deltaY*e,this.clampScroll()}onPointer(t){if(t.phase==="down"){if(t.button!==0)return;const e=this.hitTestScrollBar(t.x,t.y);if(e.hit){const i=this.scrollBarMetrics();if(e.onThumb){this.scrollDragActive=!0,this.scrollDragStartY=t.y,this.scrollDragStartScrollY=this.scrollY;return}const n=t.y-Math.floor(i.thumbH/2);this.setScrollFromThumbY(n);return}const s=this.byteIndexAt(t.x,t.y);if(s===null){this.selAnchor=null,this.selStart=null,this.selEnd=null;return}this.selAnchor=s,this.selStart=s,this.selEnd=s;return}if(t.phase==="move"){if(this.scrollDragActive){const r=this.scrollBarMetrics(),o=this.contentHeightPx(),c=this.height;if(o>c){const l=r.h-r.thumbH,b=t.y-this.scrollDragStartY,w=l>0?b/l*(o-c):0;this.scrollY=this.scrollDragStartScrollY+w,this.clampScroll()}return}if(this.selAnchor===null||(t.buttons&1)===0)return;const e=this.cellH*2;t.y<0?(this.scrollY-=e,this.clampScroll()):t.y>this.height&&(this.scrollY+=e,this.clampScroll());const s=m(t.y,0,this.height-1),i=this.byteIndexAt(t.x,s);if(i===null)return;const n=this.selAnchor;this.selStart=Math.min(n,i),this.selEnd=Math.max(n,i);return}if(t.phase==="up"){t.button===0&&(this.scrollDragActive=!1);return}}onKey(t){if(!(t.phase!=="down"||!((t.metaKey||t.ctrlKey)&&t.key.toLowerCase()==="c"))&&this.selStart!==null&&this.selEnd!==null&&this.data){const s=this.data.slice(this.selStart,this.selEnd+1),i=[];for(let r=0;r<s.length;r++)i.push(q(s[r]));const n=i.join(" ");L({type:"copy",text:n})}}applyConfig(t){let e=!1,s=!1;if(typeof t.fontPx=="number"&&Number.isFinite(t.fontPx)){const i=m(Math.floor(t.fontPx),8,48);if(i!==this.fontPx){this.fontPx=i;const{cellW:n,cellH:r,fontCss:o}=O(this.fontPx);this.cellW=n,this.cellH=r,this.fontCss=o,s=!0,e=!0}}if(t.theme&&(this.theme=C(this.theme,t.theme)),typeof t.scrollBarWidthPx=="number"&&Number.isFinite(t.scrollBarWidthPx)){const i=m(Math.floor(t.scrollBarWidthPx),8,64);i!==this.scrollBarWidthPx&&(this.scrollBarWidthPx=i,s=!0)}if(typeof t.minBytesPerRow=="number"&&Number.isFinite(t.minBytesPerRow)){const i=m(Math.floor(t.minBytesPerRow),1,1024);i!==this.minBytesPerRow&&(this.minBytesPerRow=i,s=!0)}if(typeof t.addressGapChars=="number"){const i=m(t.addressGapChars,0,8);i!==this.addressGapChars&&(this.addressGapChars=i,s=!0)}if(typeof t.hexGapChars=="number"){const i=m(t.hexGapChars,0,8);i!==this.hexGapChars&&(this.hexGapChars=i,s=!0)}if(typeof t.sectionGapChars=="number"){const i=m(t.sectionGapChars,0,16);i!==this.sectionGapChars&&(this.sectionGapChars=i,s=!0)}s&&(this.addrDigits=A(this.totalBytes-1),this.bytesPerRow=H(this.width,this.cellW,this.addrDigits,this.scrollBarWidthPx,this.minBytesPerRow,this.addressGapChars,this.hexGapChars,this.sectionGapChars),this.clampScroll()),e&&this.buildResources()}}const d=new K;self.onmessage=a=>{const t=a.data;if(t.type==="init"){d.init(t).then(()=>L({type:"ready"})).catch(e=>{const s=e instanceof Error?e.message:String(e);L({type:"error",message:s})});return}if(t.type==="resize"){d.resize(t.width,t.height);return}if(t.type==="wheel"){d.onWheel(t);return}if(t.type==="pointer"){d.onPointer(t);return}if(t.type==="key"){d.onKey(t);return}if(t.type==="config"){d.applyConfig(t);return}if(t.type==="data"&&t.buffer){const e=t.buffer,s=new Uint8Array(e);d.data=s,d.totalBytes=s.length,d.addrDigits=A(s.length>0?s.length-1:0),d.bytesPerRow=H(d.width,d.cellW,d.addrDigits,d.scrollBarWidthPx,d.minBytesPerRow,d.addressGapChars,d.hexGapChars,d.sectionGapChars),d.clampScroll()}}})();
`,E=typeof self<"u"&&self.Blob&&new Blob([R],{type:"text/javascript;charset=utf-8"});function U(i){let t;try{if(t=E&&(self.URL||self.webkitURL).createObjectURL(E),!t)throw"";const e=new Worker(t,{name:i==null?void 0:i.name});return e.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(t)}),e}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(R),{name:i==null?void 0:i.name})}finally{t&&(self.URL||self.webkitURL).revokeObjectURL(t)}}const L={background:"#FFFFFF",text:"#000000",address:"#666666",dim:"#999999",selectionBg:"#0078D4",selectionFg:"#FFFFFF",scrollTrack:"#EDEDED",scrollThumb:"#C9C9C9",scrollThumbActive:"#AFAFAF"},K={background:"#1E1E1E",text:"#FFFFFF",address:"#8EC0E4",dim:"#888888",selectionBg:"#0078D4",selectionFg:"#FFFFFF",scrollTrack:"#333333",scrollThumb:"#555555",scrollThumbActive:"#777777"};function F(i){const t=window.devicePixelRatio||1,e=i.getBoundingClientRect(),r=i.clientWidth||e.width,a=i.clientHeight||e.height,n=Math.max(1,Math.floor(r*t)),l=Math.max(1,Math.floor(a*t));return{width:n,height:l,dpr:t}}function G(i,t,e){return Math.max(t,Math.min(e,i))}function I(i){let t=i.trim();if(t.startsWith("#")&&(t=t.slice(1)),t.length!==6&&t.length!==8)return;const e=f=>Number.parseInt(t.slice(f,f+2),16),r=e(0),a=e(2),n=e(4),l=t.length===8?e(6):255;if(![r,a,n,l].some(f=>Number.isNaN(f)))return[r/255,a/255,n/255,l/255]}function B(i){return Math.max(0,Math.min(1,i))}function v(i){const t=i.trim();if(t.endsWith("%")){const r=Number.parseFloat(t.slice(0,-1));return Number.isFinite(r)?B(r/100)*255:void 0}const e=Number.parseFloat(t);if(Number.isFinite(e))return Math.max(0,Math.min(255,e))}function A(i){const t=i.trim();if(t.endsWith("%")){const r=Number.parseFloat(t.slice(0,-1));return Number.isFinite(r)?B(r/100):void 0}const e=Number.parseFloat(t);if(Number.isFinite(e))return B(e)}function H(i){const t=i.trim().match(/^rgba?\((.*)\)$/i);if(!t)return;const e=(t[1]??"").trim();if(!e)return;const r=e.includes("/")?e.split("/").map(h=>h.trim()).flatMap((h,C)=>C===0?h.split(/[ ,]+/).filter(Boolean):[h]):e.split(/\s*,\s*/);if(r.length!==3&&r.length!==4)return;const[a,n,l,f]=r;if(a===void 0||n===void 0||l===void 0)return;const p=v(a),m=v(n),s=v(l);if(p===void 0||m===void 0||s===void 0)return;const o=r.length===4?A(f??""):1;if(o!==void 0)return[p/255,m/255,s/255,o]}function O(i){return I(i)??H(i)}function M(i,t){const e=i==="light"?L:i==="dark"?K:void 0;return!e&&!t?void 0:{...e,...t}}function x(i){if(!i)return;const t={},e=(r,a)=>{if(typeof a!="string")return;const n=O(a);if(n)switch(r){case"background":t.background=n;break;case"text":t.text=n;break;case"address":t.address=n;break;case"dim":t.dim=n;break;case"selectionBg":t.selectionBg=n;break;case"selectionFg":t.selectionFg=n;break;case"scrollTrack":t.scrollTrack=n;break;case"scrollThumb":t.scrollThumb=n;break;case"scrollThumbActive":t.scrollThumbActive=n;break}};return e("background",i.background),e("text",i.text),e("address",i.address),e("dim",i.dim),e("selectionBg",i.selectionBg),e("selectionFg",i.selectionFg),e("scrollTrack",i.scrollTrack),e("scrollThumb",i.scrollThumb),e("scrollThumbActive",i.scrollThumbActive),t}class Y{constructor(t,e={}){d(this,"container");d(this,"canvas");d(this,"worker");d(this,"resizeObserver",null);d(this,"disposed",!1);d(this,"currentOptions");d(this,"onResize");d(this,"onWheel");d(this,"onPointerDown");d(this,"onPointerMove");d(this,"onPointerUp");d(this,"onKeyDown");d(this,"onKeyUp");this.currentOptions={...e},this.container=t;const r=document.createElement("canvas");r.style.width="100%",r.style.height="100%",r.style.display="block",r.style.outline="none",r.style.position="absolute",r.style.top="0",r.style.left="0",t.style.position="relative",t.appendChild(r),this.canvas=r,this.canvas.tabIndex=this.canvas.tabIndex||0;const a=r.transferControlToOffscreen();this.worker=new U,this.worker.onmessage=s=>{s.data.type==="error"?(console.error("hexviewer error: ",s.data),this.showError(s.data.message)):s.data.type==="copy"&&navigator.clipboard.writeText(s.data.text).catch(o=>{console.error("Failed to copy to clipboard:",o)})};const n=F(r),l=M(e.themePreset,e.theme),f=x(l),p={type:"init",canvas:a,width:n.width,height:n.height,dpr:n.dpr,fontPx:e.fontPx,theme:f,scrollBarWidthPx:e.scrollBarWidthPx,minBytesPerRow:e.minBytesPerRow,addressGapChars:e.addressGapChars,hexGapChars:e.hexGapChars,sectionGapChars:e.sectionGapChars};this.worker.postMessage(p,[a]),e.data!==void 0&&this.setData(e.data),this.onResize=()=>{if(this.disposed)return;this.canvas.style.width=this.container.clientWidth+"px",this.canvas.style.height=this.container.clientHeight+"px";const s=F(this.canvas),o={type:"resize",width:s.width,height:s.height,dpr:s.dpr};this.worker.postMessage(o)},this.onWheel=s=>{s.preventDefault();const o={type:"wheel",deltaX:s.deltaX,deltaY:s.deltaY,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey};this.worker.postMessage(o)};const m=s=>{const o=this.canvas.getBoundingClientRect(),h=window.devicePixelRatio||1;return{x:(s.clientX-o.left)*h,y:(s.clientY-o.top)*h}};this.onPointerDown=s=>{this.canvas.focus(),this.canvas.setPointerCapture(s.pointerId);const o=m(s),h={type:"pointer",phase:"down",x:o.x,y:o.y,button:s.button,buttons:s.buttons,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey,metaKey:s.metaKey};this.worker.postMessage(h)},this.onPointerMove=s=>{const o=m(s),h={type:"pointer",phase:"move",x:o.x,y:o.y,button:s.button,buttons:s.buttons,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey,metaKey:s.metaKey};this.worker.postMessage(h)},this.onPointerUp=s=>{const o=m(s),h={type:"pointer",phase:"up",x:o.x,y:o.y,button:s.button,buttons:s.buttons,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey,metaKey:s.metaKey};this.worker.postMessage(h)},this.onKeyDown=s=>{const o={type:"key",phase:"down",key:s.key,code:s.code,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey,metaKey:s.metaKey};this.worker.postMessage(o)},this.onKeyUp=s=>{const o={type:"key",phase:"up",key:s.key,code:s.code,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,altKey:s.altKey,metaKey:s.metaKey};this.worker.postMessage(o)},window.addEventListener("resize",this.onResize,{passive:!0}),this.canvas.addEventListener("wheel",this.onWheel,{passive:!1}),this.canvas.addEventListener("pointerdown",this.onPointerDown),this.canvas.addEventListener("pointermove",this.onPointerMove),this.canvas.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(()=>this.onResize()),this.resizeObserver.observe(this.container))}showError(t){this.canvas.style.display="none";const e=document.createElement("div");e.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f8f9fa;
      color: #333;
      padding: 20px;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `;const r=document.createElement("div");r.textContent="âš ï¸",r.style.cssText="font-size: 48px; margin-bottom: 16px;";const a=document.createElement("div");a.textContent="WebGPU ä¸å¯ç”¨",a.style.cssText="font-size: 18px; font-weight: 600; margin-bottom: 12px; color: #2c3e50;";const n=document.createElement("pre");n.textContent=t,n.style.cssText=`
      font-size: 13px;
      line-height: 1.6;
      color: #555;
      background: white;
      padding: 16px;
      border-radius: 4px;
      border: 1px solid #ddd;
      max-width: 600px;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin: 0;
    `,e.appendChild(r),e.appendChild(a),e.appendChild(n),this.container.appendChild(e)}destroy(){var t;this.disposed||(this.disposed=!0,window.removeEventListener("resize",this.onResize),this.canvas.removeEventListener("wheel",this.onWheel),this.canvas.removeEventListener("pointerdown",this.onPointerDown),this.canvas.removeEventListener("pointermove",this.onPointerMove),this.canvas.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),(t=this.resizeObserver)==null||t.disconnect(),this.resizeObserver=null,this.worker.terminate())}setFontPx(t){this.worker.postMessage({type:"config",fontPx:G(t,8,48)})}setTheme(t){const e=x(t);this.worker.postMessage({type:"config",theme:e})}setOptions(t){this.currentOptions={...this.currentOptions,...t};const e={type:"config"};if(t.fontPx!==void 0&&(e.fontPx=G(t.fontPx,8,48)),t.themePreset!==void 0||t.theme!==void 0){const r=M(this.currentOptions.themePreset,this.currentOptions.theme),a=x(r);e.theme=a}t.scrollBarWidthPx!==void 0&&(e.scrollBarWidthPx=t.scrollBarWidthPx),t.minBytesPerRow!==void 0&&(e.minBytesPerRow=t.minBytesPerRow),t.addressGapChars!==void 0&&(e.addressGapChars=t.addressGapChars),t.hexGapChars!==void 0&&(e.hexGapChars=t.hexGapChars),t.sectionGapChars!==void 0&&(e.sectionGapChars=t.sectionGapChars),this.worker.postMessage(e),t.data!==void 0&&this.setData(t.data)}setData(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else if(t!==null&&typeof t=="object"){const n=new TextEncoder,l=JSON.stringify(t,null,2);e=n.encode(l)}else e=new TextEncoder().encode(String(t));const r=e.buffer.slice(0),a={type:"data",buffer:r};this.worker.postMessage(a,[r])}}function z(i,t={}){return new Y(i,t)}const b={hello:`Hello, World! Greetings from HexViewer.
This is a high-performance hex viewer.`,binary:new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,255,254,253,252,251,250,249,248,247,246,245,244,243,242,241,240]),unicode:`ðŸš€ Unicode Test
Chinese: ä½ å¥½ä¸–ç•Œ
Emoji: ðŸ˜€ðŸ˜ƒðŸ˜„ðŸ˜ðŸ˜†ðŸ˜…ðŸ¤£ðŸ˜‚
Japanese: ã“ã‚“ã«ã¡ã¯
Korean: ì•ˆë…•í•˜ì„¸ìš”
Russian: ÐŸÑ€Ð¸Ð²ÐµÑ‚`};let u=null,c={fontPx:34,minBytesPerRow:16,addressGapChars:2,hexGapChars:.4,sectionGapChars:4,themePreset:"light",theme:{background:"#FFFFFF",text:"#000000",address:"#666666",dim:"#999999",selectionBg:"#0078D4",selectionFg:"#FFFFFF"}};function T(){const i=document.querySelector("#hex-viewer-display");if(!i)throw new Error("Container element not found");u&&u.destroy(),u=z(i,{fontPx:c.fontPx,scrollBarWidthPx:20,minBytesPerRow:c.minBytesPerRow,themePreset:c.themePreset,theme:c.theme,addressGapChars:c.addressGapChars,hexGapChars:c.hexGapChars,sectionGapChars:c.sectionGapChars}),u.setData(b.hello)}function y(i,t,e=""){const r=document.getElementById(i);r&&(r.textContent=t+e)}function S(){const i=document.getElementById("font-size"),t=document.getElementById("bytes-per-row"),e=document.getElementById("address-gap"),r=document.getElementById("hex-gap"),a=document.getElementById("section-gap"),n=document.getElementById("color-background"),l=document.getElementById("color-text"),f=document.getElementById("color-address"),p=document.getElementById("color-dim"),m=document.getElementById("color-selection-bg"),s=document.getElementById("color-selection-fg");c={fontPx:parseFloat(i.value),minBytesPerRow:parseFloat(t.value),addressGapChars:parseFloat(e.value),hexGapChars:parseFloat(r.value),sectionGapChars:parseFloat(a.value),themePreset:c.themePreset,theme:{background:n.value,text:l.value,address:f.value,dim:p.value,selectionBg:m.value,selectionFg:s.value}},u&&u.setOptions({fontPx:c.fontPx,minBytesPerRow:c.minBytesPerRow,addressGapChars:c.addressGapChars,hexGapChars:c.hexGapChars,sectionGapChars:c.sectionGapChars,themePreset:c.themePreset,theme:c.theme});const h=document.getElementById("sample-select").value;if(h==="custom"){const P=document.getElementById("custom-data").value;P&&u&&u.setData(P)}else h in b&&u&&u.setData(b[h])}function N(){document.getElementById("color-background").value="#FFFFFF",document.getElementById("color-text").value="#000000",document.getElementById("color-address").value="#666666",document.getElementById("color-dim").value="#999999",document.getElementById("color-selection-bg").value="#0078D4",document.getElementById("color-selection-fg").value="#FFFFFF",c.themePreset="light"}function V(){document.getElementById("color-background").value="#1E1E1E",document.getElementById("color-text").value="#FFFFFF",document.getElementById("color-address").value="#8EC0E4",document.getElementById("color-dim").value="#888888",document.getElementById("color-selection-bg").value="#0078D4",document.getElementById("color-selection-fg").value="#FFFFFF",c.themePreset="dark"}let w=null;function g(i=!1){w&&clearTimeout(w),i?S():w=window.setTimeout(()=>{S()},150)}function k(){var t,e,r,a,n,l,f,p,m;(t=document.getElementById("font-size"))==null||t.addEventListener("input",s=>{const o=s.target;y("font-size-value",o.value,"px"),g()}),(e=document.getElementById("bytes-per-row"))==null||e.addEventListener("input",s=>{const o=s.target;y("bytes-per-row-value",o.value),g()}),(r=document.getElementById("address-gap"))==null||r.addEventListener("input",s=>{const o=s.target;y("address-gap-value",o.value),g()}),(a=document.getElementById("hex-gap"))==null||a.addEventListener("input",s=>{const o=s.target;y("hex-gap-value",o.value),g()}),(n=document.getElementById("section-gap"))==null||n.addEventListener("input",s=>{const o=s.target;y("section-gap-value",o.value),g()}),["color-background","color-text","color-address","color-dim","color-selection-bg","color-selection-fg"].forEach(s=>{var o;(o=document.getElementById(s))==null||o.addEventListener("input",()=>{g()})}),(l=document.getElementById("theme-light"))==null||l.addEventListener("click",()=>{N(),g(!0)}),(f=document.getElementById("theme-dark"))==null||f.addEventListener("click",()=>{V(),g(!0)}),(p=document.querySelector("#custom-data"))==null||p.addEventListener("blur",s=>{const o=s.target.value;console.log("content:",o,s),o&&u&&u.setData(o)}),(m=document.getElementById("sample-select"))==null||m.addEventListener("change",s=>{const o=s.target,h=document.getElementById("custom-data-group");o.value==="custom"?h&&(h.style.display="block"):(h&&(h.style.display="none"),u&&u.setData(b[o.value]))})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{T(),k()}):(T(),k());
